<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <button onclick="getQuotes()">test</button>
    <h3>hallo</h3>
    <!-- </select> -->

    <script type="text/javascript">
      class QuotesParser {
        constructor() {
          this.quotes = new Array();
          this.fetcher = new XMLHttpRequest();
          this.lastIndex = +localStorage.getItem("quotes-index") || 0;
          this.data = [];
          this.fetcher.addEventListener("load", () => {
            const parserQuotes = JSON.parse(this.fetcher.responseText);
            this.data = parserQuotes.slice(this.lastIndex);
            console.log(this.data.length);
          });
          this.fetcher.open("GET", "/public/data/quote.json");
          this.fetcher.send();
        }

        iterateQuotes() {
          let { data, lastIndex } = this;
          let end = 10,
            start = 0;
          return {
            [Symbol.iterator]() {
              return this;
            },
            next() {
              if (start === end) {
                console.log(lastIndex);
                localStorage.setItem("quotes-index", (lastIndex += 10));
                console.log(start);
                console.log(end);
                start = 0;
              }
              return {
                value: {
                  idx: start,
                  lidx: end,
                  data: data[start++],
                },
                done: false,
              };
            },
          };
        }
      }

      // const getQUotes = QuoteApi.getQuotes();
      class QuoteApi {
        static qParser = new QuotesParser();
        static *generateQuotes() {
          for (let n of QuoteApi.qParser.iterateQuotes()) {
            yield n;
          }
        }
        static initGQuotes = QuoteApi.generateQuotes();
        static getQuote() {
          const data = QuoteApi.initGQuotes.next();
          if (!data.value && data.done) return null;
          if (!data.value) return testGetQuotes();
          else if (data.done) return null;
          return data.value;
        }
        static test() {
          console.log("test");
        }
      }
      const newTest = QuoteApi.getQuote;
      const test = new QuotesParser();
      // console.log(test.getQUotes());
      function* generateQuotes() {
        for (let n of test.iterateQuotes()) {
          yield n;
        }
      }
      const getQUotes = generateQuotes();
      function testGetQuotes() {
        const data = getQUotes.next();
        if (!data.value && data.done) return null;
        if (!data.value) return testGetQuotes();
        else if (data.done) return null;
        return data.value;
      }
    </script>
    <script type="module"></script>
  </body>
</html>
